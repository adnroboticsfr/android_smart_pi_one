name: Build Android Source

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Install necessary packages
      run: |
        sudo apt-get update
        sudo apt-get install -y git curl

    - name: Install repo tool
      run: |
        mkdir -p ~/bin
        curl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo
        chmod a+x ~/bin/repo
        echo "$HOME/bin" >> $GITHUB_PATH

    - name: Create android-source directory
      run: mkdir -p ~/android-source

    - name: Initialize repo
      run: |
        cd ~/android-source
        repo init -u https://android.googlesource.com/platform/manifest
        repo sync

    - name: Build with Gradle
      run: |
        cd ~/android-source
        ./gradlew build
